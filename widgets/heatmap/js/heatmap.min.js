(function(){FXStreetWidgets.Widget.Base=function(n){var t={};return t.loaderBase=n,t.data=FXStreetWidgets.Widget.Base.prototype.data,t.interval=FXStreetWidgets.Widget.Base.prototype.interval,t.init=FXStreetWidgets.Widget.Base.prototype.init,t.setSettingsByObject=FXStreetWidgets.Widget.Base.prototype.setSettingsByObject,t.addEvents=FXStreetWidgets.Widget.Base.prototype.addEvents,t.setVars=FXStreetWidgets.Widget.Base.prototype.setVars,t.loadData=FXStreetWidgets.Widget.Base.prototype.loadData,t.loadDataFromUrl=FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl,t.setDatesToJson=FXStreetWidgets.Widget.Base.prototype.setDatesToJson,t.renderHtml=FXStreetWidgets.Widget.Base.prototype.renderHtml,t.log=FXStreetWidgets.Widget.Base.prototype.log,t};FXStreetWidgets.Widget.Base.prototype.loaderBase=null;FXStreetWidgets.Widget.Base.prototype.data=null;FXStreetWidgets.Widget.Base.prototype.interval=null;FXStreetWidgets.Widget.Base.prototype.init=function(n){this.setSettingsByObject(n)};FXStreetWidgets.Widget.Base.prototype.setSettingsByObject=function(n){for(var t in n)n.hasOwnProperty(t)&&this[t]!==undefined&&(this[t]=n[t])};FXStreetWidgets.Widget.Base.prototype.addEvents=function(){};FXStreetWidgets.Widget.Base.prototype.setVars=function(){};FXStreetWidgets.Widget.Base.prototype.loadData=function(n){this.loadDataFromUrl(this.loaderBase.config.EndPoint,n)};FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl=function(n,t){var i=this;FXStreetWidgets.Util.ajaxJsonGetter(n,t).done(function(n){i.data=n;i.loaderBase.isReady()?(i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml()):i.interval=setInterval(function(){i.loaderBase.isReady()&&(clearInterval(i.interval),i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml())},i.intervalTimeToWaitForReady)})};FXStreetWidgets.Widget.Base.prototype.setDatesToJson=function(n,t){var i=FXStreetWidgets.Util.formatDateResponse(t);return n.LastUpdatedDate=t.Value,n.LastUpdatedHour=i,n};FXStreetWidgets.Widget.Base.prototype.renderHtml=function(){};FXStreetWidgets.Widget.Base.prototype.log=function(n){FXStreetWidgets.Util.log(n)}})(),function(n){FXStreetWidgets.Widget.LoaderBase=function(t){var i={};return i.options=t,i.config=FXStreetWidgets.Widget.LoaderBase.prototype.config,i.isReady=FXStreetWidgets.Widget.LoaderBase.prototype.isReady,i.isReadyCustomCheck=FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck,i.initConfiguration=FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration,i.getContainer=FXStreetWidgets.Widget.LoaderBase.prototype.getContainer,i.getHost=FXStreetWidgets.Widget.LoaderBase.prototype.getHost,i.getVersion=FXStreetWidgets.Widget.LoaderBase.prototype.getVersion,i.getCss=FXStreetWidgets.Widget.LoaderBase.prototype.getCss,i.getCustomJs=FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs,i.getEndPoint=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint,i.getEndPointTranslation=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation,i.initWidgets=FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets,i.log=FXStreetWidgets.Widget.LoaderBase.prototype.log,i.mustachesCount=0,i.mustachesLoadedCount=0,i.customJsCount=0,i.customJsLoadedCount=0,i.translationsLoaded=!1,i.cssLoaded=!1,i.haveCustomJs=!1,i.init=function(){if(!FXStreetWidgets.Util.isValid(i.options)||!FXStreetWidgets.Util.isValid(i.options.WidgetName)||!i.options.WidgetName.trim()){i.log("unable to load fxswidget options bad configure.");return}FXStreetWidgets.Initialization.registerLoader(i.options.WidgetName,i);i.initConfiguration();i.loadUtils();var t=n("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");i.initWidgets(t)},i.loadDeferred=function(n){i.log("loading deferred "+i.options.WidgetName);var t=n.find("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");i.initWidgets(t)},i.loadUtils=function(){FXStreetWidgets.Util.ajaxJsonGetter(i.config.EndPointTranslation).done(function(n){i.translationsLoaded=!0;i.config.Translations=n.Values});var t=FXStreetWidgets.Configuration.getCssUrl(i.config.Css+".min.css",i.config.Css);FXStreetWidgets.ResourceManagerObj.load(i.config.Css,FXStreetWidgets.ResourceType.Css,t,function(){i.cssLoaded=!0});n.each(i.config.CustomJs,function(n,t){i.customJsCount++;var r=FXStreetWidgets.Configuration.getCoreJsUrl(t);FXStreetWidgets.ResourceManagerObj.load(r,FXStreetWidgets.ResourceType.Js,r,function(){i.customJsLoadedCount++})});n.each(i.config.Mustaches,function(n){i.mustachesCount++;var t=n+".html",r=FXStreetWidgets.Configuration.getMustacheUrl(t,i.options.WidgetName);FXStreetWidgets.ResourceManagerObj.load(t,FXStreetWidgets.ResourceType.Mustache,r,function(t){i.config.Mustaches[n]=t.Value;i.mustachesLoadedCount++})})},i};FXStreetWidgets.Widget.LoaderBase.prototype.config={};FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets=function(){};FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration=function(){this.log("init configuration for: "+this.options.WidgetName);var n=this.getContainer(),t=this.getHost(n),i=this.getVersion(n),r=this.getCss(),u=this.getCustomJs();this.config={WidgetName:this.options.WidgetName,Culture:FXStreetWidgets.Configuration.getCulture(),EndPoint:this.getEndPoint(t,i),EndPointTranslation:this.getEndPointTranslation(t,i),DefaultHost:this.options.DefaultHost,Css:r,CustomJs:u,Mustaches:this.options.Mustaches,Translations:{}}};FXStreetWidgets.Widget.LoaderBase.prototype.getContainer=function(){return n("div[fxs_widget][fxs_name='"+this.options.WidgetName+"']").first()};FXStreetWidgets.Widget.LoaderBase.prototype.getHost=function(n){n=n||this.getContainer();var t=n.attr("fxs_host");return FXStreetWidgets.Util.isUndefined(t)?this.options.DefaultHost:t};FXStreetWidgets.Widget.LoaderBase.prototype.getVersion=function(n){n=n||this.getContainer();var t=n.attr("fxs_version")||this.options.DefaultVersion;return FXStreetWidgets.Util.isUndefined(t)?"":t+"/"};FXStreetWidgets.Widget.LoaderBase.prototype.getCss=function(){return FXStreetWidgets.Util.isValid(this.options.Css)?this.options.Css:this.options.WidgetName};FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.CustomJs)&&(this.haveCustomJs=!0,n=this.options.CustomJs),n};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint=function(n,t){return n+t+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPoint};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation=function(n,t){return n+t+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPointTranslation};FXStreetWidgets.Widget.LoaderBase.prototype.isReady=function(){var n=this.translationsLoaded===!0&&this.cssLoaded===!0&&(this.haveCustomJs===!1||this.haveCustomJs===!0&&this.customJsLoadedCount>=this.customJsCount)&&this.mustachesLoadedCount===this.mustachesCount;return n=n&&this.isReadyCustomCheck(),n===!0&&this.log("loader ready for: "+this.options.WidgetName),n};FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck=function(){return!0};FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded=function(){return typeof d3!="undefined"&&typeof c3!="undefined"};FXStreetWidgets.Widget.LoaderBase.prototype.log=function(n){FXStreetWidgets.Util.log(n)}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.HeatMapBase=function(t){var r=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(r);return i.Container=null,i.WidgetId=null,i.AssetIds="",i.Seo=!1,i.MustacheKey="",i.FormatUrl="",i.PairKey="{{asset}}",i.TrendCssClasess={StronglyBearish:"fxs_heatmap_bearish",Bearish:"fxs_heatmap_slightlybearish",Neutral:"fxs_heatmap_neutral",Bullish:"fxs_heatmap_bullish",SlightlyBullish:"fxs_heatmap_slightlybullish"},i.PerformanceStatusCssClasess={Positive:"price_up",Negative:"price_down",Neutral:"price_neutral"},i.init=function(n){i.setSettingsByObject(n);i.setVars();i.loadDataFromUrl(i.loaderBase.config.EndPoint+"/"+i.AssetIds)},i.setVars=function(){i.WidgetId="hm_"+FXStreetWidgets.Util.guid()},i.getPerformanceStatus=function(n){return n>0?i.PerformanceStatusCssClasess.Positive:n<0?i.PerformanceStatusCssClasess.Negative:i.PerformanceStatusCssClasess.Neutral},i.renderHtml=function(){var n,t;i.data.Values!==null&&i.data.Values.length!==0&&(n={Studies:i.getStudies(i.data.Values),Translations:i.loaderBase.config.Translations,WidgetId:i.WidgetId},n=i.setDatesToJson(n,i.data.Values[0].Date),i.setUrls(n),t=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches[i.MustacheKey],n),i.Container.html(t),i.manageRenderedHtml())},i.setUrls=function(t){n.each(t.Studies,function(t,r){n.each(r.Items,function(n,t){i.FormatUrl&&(t.Url=i.FormatUrl.indexOf(i.PairKey)>-1?i.FormatUrl.replace(i.PairKey,t.Asset.Url):i.FormatUrl+t.Asset.Url,t.Url=t.Url.toLowerCase())})})},i.getStudies=function(t){n.each(t,function(n,t){t.TrendCssClasess=i.TrendCssClasess[t.Trend];t.PerformanceStatusCssClasess=i.getPerformanceStatus(t.PerformancePercentage);t.TypeDisplay=i.loaderBase.config.Translations[t.Type]});return i.getStudyItems(t)},i.createStudyItem=function(n){return{PeriodTypeCode:n,PeriodTypeValue:i.loaderBase.config.Translations[n],Items:[]}},i.getStudyItems=function(t){var r=[];return n.each(t,function(t,u){var f=n.grep(r,function(n){return n.PeriodTypeCode===u.Type});f.length===0&&r.push(i.createStudyItem(u.Type))}),n.each(r,function(i,r){n.each(t,function(n,t){r.PeriodTypeCode===t.Type&&r.Items.push(t)})}),r},i.manageRenderedHtml=function(){i.setFirstTabActive();i.setToolTip()},i.setToolTip=function(){i.Container.find('[data-toggle="tooltip"]').tooltip()},i.setFirstTabActive=function(){i.Container.find(".fxs_tabs_nav li").first().addClass("active");i.Container.find('div[role="tabpanel"]').first().addClass("fade in active")},i}}(FXStreetWidgets.$),function(){FXStreetWidgets.Widget.HeatMap=function(n){var t=FXStreetWidgets.Widget.HeatMapBase(n),i=FXStreetWidgets.Util.extendObject(t);return t.MustacheKey=i.loaderBase.config.WidgetName,i}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.LoaderHeatMap=function(){var i=FXStreetWidgets.Widget.LoaderBase({WidgetName:"heatmap",EndPoint:"heatmap/study/",EndPointTranslation:"heatmap/localization/",DefaultHost:"http://markettools.api.fxstreet.com/",Mustaches:{heatmap:""},Css:"heatmap",DefaultVersion:"v1"}),t=FXStreetWidgets.Util.extendObject(i);return i.initWidgets=function(i){n.each(i,function(i,r){var u=n(r),f={Container:u,AssetIds:u.attr("fxs_assets"),FormatUrl:u.attr("fxs_format_url")},e,o;FXStreetWidgets.Util.isUndefined(f.AssetIds)?console.log("fxserror unable to create "+t.config.WidgetName+", assets value cannot be empty"):(e=!0,f.AssetIds.split(",").forEach(function(n){n.startsWith("fxs-")||(console.log("fxserror unable to create "+t.config.WidgetName+", asset not valid: "+n),e=!1)}),e&&(o=new FXStreetWidgets.Widget.HeatMap(t),o.init(f)))})},t},function(){var n=new FXStreetWidgets.Widget.LoaderHeatMap;n.init()}()}(FXStreetWidgets.$);
//# sourceMappingURL=heatmap.min.js.map
